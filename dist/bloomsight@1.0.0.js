(()=>{"use strict";var e={31:(e,s,i)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.DataEventTransmissionService=void 0;const t=i(932),o=i(795),r=i(225);class n extends t.TransmissionService{trigger(e,s,i,t,n,d,c,l,a,h){let v={property:window.propertyToken,dataEventToken:e,eventLogData:s,userId:i,newUser:t,newSession:n,returningUser:!t,ipAddress:d,countryCode:c,osName:l,deviceType:a,browserName:h};window.isDevelopmentMode&&console.log("Data event logged",v),this.executePostPayload(o.RequestMapperService.ADD_DATA_EVENT,v,r.ConstantService.REQUEST_HEADERS,(()=>{}),(e=>{}),(e=>{}),(()=>{}),(()=>{}))}}s.DataEventTransmissionService=n},550:(e,s,i)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.SimpleEventTransmissionService=void 0;const t=i(932),o=i(795),r=i(225);class n extends t.TransmissionService{trigger(e,s,i,t,n,d,c,l,a){let h={property:window.propertyToken,simpleEventToken:e,userId:s,newUser:i,newSession:t,returningUser:!i,ipAddress:n,countryCode:d,osName:c,deviceType:l,browserName:a};window.isDevelopmentMode&&console.log("Simple event logged",h),this.executePostPayload(o.RequestMapperService.ADD_SIMPLE_EVENT,h,r.ConstantService.REQUEST_HEADERS,(()=>{}),(e=>{}),(e=>{}),(()=>{}),(()=>{}))}}s.SimpleEventTransmissionService=n},932:(e,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.TransmissionService=void 0,s.TransmissionService=class{executePostPayload(e,s,i,t,o,r,n,d){t(),fetch(e,{method:"POST",headers:i,body:JSON.stringify(s)}).then((e=>e.json())).then((e=>{o(e),e.success&&r(e)})).catch((e=>{console.log("catch",e),n(e.toString())})).finally((()=>d()))}}},273:(e,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ConfigurationService=void 0;class i{constructor(){}}s.ConfigurationService=i,i.PRODUCTION=!0,i.SECURE_CONNECT=i.PRODUCTION,i.PROTOCOL=i.SECURE_CONNECT?"https://":"http://",i.DOMAIN_PRODUCTION="api.bloomsight.io",i.DOMAIN_LOCALHOST="localhost",i.API_PREFIX="/api/v1",i.DOMAIN=i.PRODUCTION?i.DOMAIN_PRODUCTION:i.DOMAIN_LOCALHOST,i.SERVER_PORT=i.PRODUCTION?"":":3000",i.API_ENDPOINT=i.PROTOCOL+i.DOMAIN+i.SERVER_PORT+i.API_PREFIX},225:(e,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.ConstantService=void 0;class i{constructor(){}}s.ConstantService=i,i.PROPERTY_TOKEN_CONFIG="PROPERTY_ID",i.REQUEST_HEADERS=new Headers({"Content-Type":"application/json"})},13:(e,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.LocalStorageService=void 0,s.LocalStorageService=class{constructor(){this._sessionTimeKey="sessionEnd",this._userKey="userId",this._eventListKey="eventList"}store(e,s){localStorage.setItem(e,s)}retrieve(e){const s=localStorage.getItem(e);return null===s?"":s}storeEventList(e){this.store(this._eventListKey,JSON.stringify(e))}retrieveEventList(){return JSON.parse(this.retrieve(this._eventListKey))}}},826:(e,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.PlatformService=void 0,s.PlatformService=class{constructor(){this.browser="",this.os="",this.device="",this._userAgent="",this._userAgent=window.navigator.userAgent}init(){this.detectBrowser(),this.detectOS(),this.detectDevice(),window.isDevelopmentMode&&(console.log(`Browser detected: ${this.browser}`),console.log(`OS detected:  ${this.os}`),console.log(`Device detected:  ${this.device}`))}detectBrowser(){let e=0,s=0;-1!==this._userAgent.indexOf("Opera")?this.browser="Opera":-1!==this._userAgent.indexOf("OPR")?this.browser="Opera Next":-1!==this._userAgent.indexOf("Edge")?this.browser="Microsoft Edge (Legacy)":-1!==this._userAgent.indexOf("Edg")?this.browser="Microsoft Edge (Chromium)":-1!==this._userAgent.indexOf("Chrome")?this.browser="Google Chrome":-1!==this._userAgent.indexOf("Safari")?this.browser="Apple Safari":-1!==this._userAgent.indexOf("Firefox")?this.browser="Mozilla Firefox":-1!==this._userAgent.indexOf("MSIE")||-1!==this._userAgent.indexOf("Trident")?this.browser="Microsoft Internet Explorer":(e=this._userAgent.lastIndexOf(" ")+1)<(s=this._userAgent.lastIndexOf("/"))?this.browser=this._userAgent.substring(e,s):this.browser="Unknown"}detectOS(){-1!==this._userAgent.indexOf("Windows")?this.os="Windows":-1!==this._userAgent.indexOf("Mac OS")?this.os="MacOS":-1!==this._userAgent.indexOf("Linux")?this.os="Linux":-1!==this._userAgent.indexOf("Android")?this.os="Android":-1!==this._userAgent.indexOf("iOS")?this.os="iOS":this.os="Unknown"}detectDevice(){/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(this._userAgent)?this.device="Tablet":/Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Kindle|NetFront|Silk-Accelerated|(hpw|webOS)/i.test(this._userAgent)?this.device="Mobile":this.device="Desktop"}}},795:(e,s,i)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.RequestMapperService=void 0;const t=i(273);class o{constructor(){}}s.RequestMapperService=o,o.ADD_SIMPLE_EVENT=t.ConfigurationService.API_ENDPOINT+"/simple-event-data/add",o.ADD_DATA_EVENT=t.ConfigurationService.API_ENDPOINT+"/data-event-data/add"},447:(e,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.SessionStorageService=void 0,s.SessionStorageService=class{store(e,s){sessionStorage.setItem(e,s)}retrieve(e){const s=sessionStorage.getItem(e);return null===s?"":s}}},880:(e,s,i)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.SessionService=void 0;const t=i(447),o=i(13),r=i(530);class n{constructor(){this._ipKey="h#6MNsN!4*z@E4",this._countryKey="Ytb^8HRfD&k3Lx",this._sessionExpiryTimeKey="WkDw3aZ#HD6^Ar",this._sessionExpiryTimeInMilliseconds=0,this._sessionCheckInterval=0,this.isNewSession=!0,this._localStore=new o.LocalStorageService,this._sessionStore=new t.SessionStorageService,this.checkSessionActivity=()=>{const e=Date.now();window.isDevelopmentMode&&console.log(`session will be active for:  ${r.UtilityService.convertSecondsToMinuteAndSeconds(Math.floor((this._sessionExpiryTimeInMilliseconds-e)/1e3))}`),e>this._sessionExpiryTimeInMilliseconds&&this.resetSession()}}init(){this.setIPAndCountry(),this.startSession(),window.isDevelopmentMode&&console.log("New session started")}setIPAndCountry(){fetch("https://jsonip.com",{mode:"cors"}).then((e=>e.json())).then((e=>{this.storeIP(e.ip),this.storeCountryCode(e.country),window.isDevelopmentMode&&(console.log(`IP detected: ${this._sessionStore.retrieve(this._ipKey)}`),console.log(`Country detected: ${this._sessionStore.retrieve(this._countryKey)}`))})).catch((e=>{window.isDevelopmentMode&&console.error("Unable to get IP",e)}))}startSession(){0!=this._sessionCheckInterval&&window.clearInterval(this._sessionCheckInterval),this._sessionExpiryTimeInMilliseconds=Date.now()+60*n._sessionDurationInMinutes*1e3,this._localStore.store(this._sessionExpiryTimeKey,this._sessionExpiryTimeInMilliseconds.toString()),this._sessionCheckInterval=window.setInterval(this.checkSessionActivity,6e4)}extendSession(){window.isDevelopmentMode&&console.log("Existing session extended"),this.isNewSession=!1,this.startSession()}resetSession(){window.isDevelopmentMode&&console.log("New session started"),this.isNewSession=!0,this.startSession()}storeIP(e){this._sessionStore.store(this._ipKey,e)}retrieveIP(){return this._sessionStore.retrieve(this._ipKey)}storeCountryCode(e){this._sessionStore.store(this._countryKey,e)}retrieveCountryCode(){return this._sessionStore.retrieve(this._countryKey)}retrieveSessionExpiryTime(){return 0!=this._sessionExpiryTimeInMilliseconds||(this._sessionExpiryTimeInMilliseconds=+this._localStore.retrieve(this._sessionExpiryTimeKey)),this._sessionExpiryTimeInMilliseconds}}s.SessionService=n,n._sessionDurationInMinutes=30},768:(e,s,i)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.UserService=void 0;const t=i(13),o=i(530),r=i(880);class n{constructor(){this._userId=null,this._userKey="EUJLo$Wu$6iH#s",this.isNewUser=!1,this._localStore=new t.LocalStorageService,this._session=new r.SessionService}init(){this.initUser(),this.validateUserTenure()}validateUserTenure(){let e=this._session.retrieveSessionExpiryTime(),s=Date.now();0!=e?s>e&&(this.isNewUser=s-e>864e5*n._userTenureInDays):this.isNewUser=!0}initUser(){this._userId=this.retrieveUser(),""===this._userId?(this._userId=o.UtilityService.getUniqueId(),this.isNewUser=!0,window.isDevelopmentMode&&console.log(`New user generated: ${this._userId}`)):(this.isNewUser=!1,window.isDevelopmentMode&&console.log(`Existing user retrieved: ${this._userId}`)),this.storeUser(this._userId)}storeUser(e){this._localStore.store(this._userKey,e)}retrieveUser(){return null!=this._userId||(this._userId=this._localStore.retrieve(this._userKey)),this._userId}}s.UserService=n,n._userTenureInDays=45},530:(e,s)=>{Object.defineProperty(s,"__esModule",{value:!0}),s.UtilityService=void 0,s.UtilityService=class{static getUniqueId(){return(Date.now()+Math.random()).toString(36)}static convertSecondsToMinuteAndSeconds(e){return e<0?"0 seconds":`${Math.floor(e/60)} minute(s) and ${e%60} second(s)`}}}},s={};function i(t){var o=s[t];if(void 0!==o)return o.exports;var r=s[t]={exports:{}};return e[t](r,r.exports,i),r.exports}(()=>{const e=i(880),s=i(768),t=i(826),o=i(31),r=i(550),n=i(225);let d=Date.now();const c=new t.PlatformService,l=new e.SessionService,a=new s.UserService,h=new r.SimpleEventTransmissionService,v=new o.DataEventTransmissionService;function u(){d+6e4-Date.now()<0&&(l.extendSession(),d=Date.now())}c.init(),l.init(),a.init(),window.bloomsightConfig=(e,s)=>{e==n.ConstantService.PROPERTY_TOKEN_CONFIG&&(window.propertyToken=s,window.isDevelopmentMode&&console.log(`Property ID: ${window.propertyToken}`))},window.addEventListener("click",u),window.addEventListener("scroll",u),window.addEventListener("wheel",u),window.addEventListener("mousemove",u),window.addEventListener("keydown",u),window.logBloomsightSimpleEvent=e=>{h.trigger(e,a.retrieveUser(),a.isNewUser,l.isNewSession,l.retrieveIP(),l.retrieveCountryCode(),c.os,c.device,c.browser)},window.logBloomsightDataEvent=(e,s)=>{v.trigger(e,s,a.retrieveUser(),a.isNewUser,l.isNewSession,l.retrieveIP(),l.retrieveCountryCode(),c.os,c.device,c.browser)}})()})();